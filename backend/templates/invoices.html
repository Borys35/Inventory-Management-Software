{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Invoices{% endblock %}</h1>
{% endblock %}

{% block content %}
<style>

    input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
    /* display: none; <- Crashes Chrome on hover */
    -webkit-appearance: none;
    margin: 0; /* <-- Apparently some margin are still there even though it's hidden */
}

input[type=number] {
    -moz-appearance:textfield; /* Firefox */
}
</style>
    <div>
        <form class="form" method="POST" action="{{ url_for('invoice.create_invoice') }}">
            <label>Invoice Number (np. FV/2026/01)
            <input type="text" name="invoice_number" required></label>
            <br/>
            
            <label>Net Cost (PLN)
            <input type="number" step="0.01" id="net_cost" name="net_cost" placeholder="0.00" required></label>
            <br/>
            
            <label>
                VAT
                <select id="vat_rate" name="vat_rate">
                    <option value="0">0%</option>
                    <option value="8">8%</option>
                    <option value="23">23%</option>
                </select>
            </label>
            <br/>

            <label>Gross Cost (PLN)
            <input type="number" step="0.01" id="gross_cost" name="gross_cost" placeholder="0.00" required readonly>
            <br/>
            
            <button type="submit">Save Invoice</button>
        </form>
    </div>

    <table border="1" cellpadding="5" cellspacing="0" style="width: 100%;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Numer Faktury</th>
                <th>Netto</th>
                <th>Brutto</th>
            </tr>
        </thead>
        <tbody>
            {% for inv in invoices %}
            <tr>
                <td>{{ inv.id }}</td>
                <td><strong>{{ inv.invoice_number }}</strong></td>
                <td>{{ inv.net_cost }} PLN</td>
                <td>{{ inv.gross_cost }} PLN</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4">Brak faktur.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const netInput = document.getElementById('net_cost');
            const vatSelect = document.getElementById('vat_rate');
            const grossInput = document.getElementById('gross_cost');

            function calculateGross() {
                const netValue = parseFloat(netInput.value);
                
                if (isNaN(netValue)) {
                    grossInput.value = '';
                    return;
                }

                let vatRate = parseFloat(vatSelect.value); 
                
                if (isNaN(vatRate)) {
                     const vatText = vatSelect.options[vatSelect.selectedIndex].text;
                     vatRate = parseFloat(vatText.replace('%', ''));
                }

                const grossValue = netValue * (1 + (vatRate / 100));
                grossInput.value = grossValue.toFixed(2);
            }

            netInput.addEventListener('blur', calculateGross);
            vatSelect.addEventListener('change', calculateGross);
        });
    </script>
{% endblock %}